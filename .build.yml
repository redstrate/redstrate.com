image: alpine/edge
packages:
  - rsync
  - git
  - hugo
sources:
  - https://git.sr.ht/~redstrate/redstrate.com
secrets:
  - b748582a-5d31-4fe8-94d6-4a63035e97aa
tasks:
  - build: |
      cd redstrate.com
      hugo --baseURL https://redstrate.com/ --minify
  - deploy: |
      cd redstrate.com
      echo "StrictHostKeyChecking=no" >> ~/.ssh/config
      rsync -Wvr public/ deploy@ryne.moe:/var/ryne/sync/redstrate.com
