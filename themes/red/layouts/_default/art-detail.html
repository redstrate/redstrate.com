{{ define "main" }}
    <h2>{{ .Title }}</h2>

    <hr>

    {{ with resources.Get .Params.filename }}
        {{ if $.Params.threed }}
        {{ $cameraorbit := $.Params.orbit }}
        {{ $cameratarget := $.Params.target }}
        {{ $fov  := $.Params.fov }}
        <model-viewer src="{{ .RelPermalink }}" shadow-intensity="1" camera-controls touch-action="pan-y" camera-orbit="{{ $cameraorbit }}" camera-target="{{ $cameratarget }}" field-of-view="{{ $fov }}"></model-viewer>
        {{ else }}
        <img class="article-img" style="display: block; max-height: 1000px; margin-left: auto; margin-right: auto;" alt="{{ $.Params.alt_text }}" title="{{ $.Params.alt_text }}" src="{{ .RelPermalink }}"/>
        {{ end }}
    {{ end }}

    <table>
    <tr>
        <th>Date</th>
        <td>
            <time datetime="{{ .Page.Lastmod.Format "Mon Jan 10 17:13:38 2020 -0700" }}" class="text-muted">
                {{ $.Date.Format "January 2006" }}
            </time>
        </td>
    </tr>

    {{ with .Params.arttags }}
        <tr>
            <th>Tags</th>
            <td>
                {{ $len := (len .) }}
                {{ range $index, $element := . }}
                <a href="/art/tags/{{ urlize . }}/"><strong>{{ $element }}</strong></a>{{ if not (eq (add $index 1) $len) }},{{ end }}
                {{ end }}
            </td>
        </tr>
    {{ end }}

    {{ with .Params.characters }}
        <tr>
            <th>Characters</th>
            <td>
                {{ $len := (len .) }}
                {{ range $index, $element := . }}
                <a href="/art/characters/{{ urlize .}}/"><strong>{{ $element }}</strong></a>{{ if not (eq (add $index 1) $len) }},{{ end }}
                {{ end }}
            </td>
        </tr>
    {{ end }}

    {{ with .Params.program }}
        <tr>
            <th>Program</th>
            <td>
                {{ . }}
            </td>
        </tr>
    {{ end }}

    {{ with .Params.mastodon_url }}
        <tr>
            <th>Mastodon URL</th>
            <td>
                <a href="{{ . }}">{{ . }}</a>
            </td>
        </tr>
    {{ end }}

    {{ with .Params.newgrounds_url }}
        <tr>
            <th>Newgrounds URL</th>
            <td>
                <a href="{{ . }}">{{ . }}</a>
            </td>
        </tr>
    {{ end }}


    {{ with .Params.pixiv_url }}
        <tr>
            <th>Pixiv URL</th>
            <td>
                <a href="{{ . }}">{{ . }}</a>
            </td>
        </tr>
    {{ end }}

    {{ partial "voting" . }}

    </table>

    {{ with .Content }}
    <h3>Commentary</h3>

    <p>
        {{ . }}
    </p>
    {{ end }}

    {{ if .Params.threed }}
        {{ $site := resources.Get "js/model-viewer.min.js" }}
        {{ if hugo.IsProduction }}
            {{ $site = $site | fingerprint | resources.PostProcess }}
        {{ end }}
        <script type="module" src="{{ $site.RelPermalink }}" integrity="{{ $site.Data.Integrity }}"></script>
    {{ end }}

    {{ partial "comments" . }}
{{ end }}
