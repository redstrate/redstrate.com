{{ define "main" }}
    <h2>{{ .Title }}</h2>

    {{ .Content }}

    {{ $selected_year := $.Param "selectedyear" }}
    {{ $art := (index site.Data ($.Param "json")) }}
    {{ $pixiv_icon := resources.Get "pixiv.webp" }}
    {{ $newgrounds_icon := resources.Get "newgrounds.webp" }}

    <details>
    <summary>Table of Contents</summary>
    <ul>
    {{ range $art.categories }}
        {{ $without_space :=  replaceRE "(\\s)" "" .name }}
        <li><a href="#{{ $without_space }}">{{ .name }}</a></li>
    {{ end }}
    </ul>
    </details>

    {{ range $art.categories }}
        {{ $should_include := false }}

        {{ range sort .years "year" "desc" }}
            {{ if eq (int .year) (int $selected_year) }}
                {{ $should_include = true }}
            {{ end }}
        {{ end }}

        {{ if $should_include }}
            {{ $without_space :=  replaceRE "(\\s)" "" .name }}
            <h3 id="{{ $without_space }}">{{ .name }}</h3>
            {{ range sort .years "year" "desc" }}
                {{ if eq (int .year) (int $selected_year) }}
                    {{ $year := .year }}

                    <div class="grid">
                    {{ range .pieces }}
                            {{ $filename_without_ext := strings.TrimSuffix (path.Ext .filename) .filename }}

                            {{ $path := printf "/art/%s" $filename_without_ext}}
                            {{ with $.Site.GetPage $path }}
                                {{ partial "render-art" . }}
                            {{ end }}
                        {{ end }}
                    </div>
                {{ end }}
            {{ end }}
        {{ end }}
    {{ end }}

    {{ $site := resources.Get "js/site.js" }}
    {{ if hugo.IsProduction }}
        {{ $site = $site | minify | fingerprint | resources.PostProcess }}
    {{ end }}
    <script src="{{ $site.RelPermalink }}" integrity="{{ $site.Data.Integrity }}"></script>
{{ end }}
